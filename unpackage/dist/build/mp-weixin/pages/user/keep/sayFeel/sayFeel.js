(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/keep/sayFeel/sayFeel"],{"03ea":function(t,e,a){"use strict";a("d23f");var i=o(a("b0ce")),s=o(a("feef"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},"1dcf":function(t,e,a){"use strict";a.r(e);var i=a("2612"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},2612:function(t,e,a){"use strict";(function(t){var a;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"robby-image-upload",props:["value","enableDel","enableAdd","enableDrag","serverUrl","formData","limit","fileKeyName","showUploadProgress","serverUrlDeleteImage"],data:function(){return{imageBasePos:{x0:-1,y0:-1,w:-1,h:-1},showMoveImage:!1,moveImagePath:"",moveLeft:0,moveTop:0,deltaLeft:0,deltaTop:0,dragIndex:null,targetImageIndex:null,imageList:[]}},onLoad:function(){this.imageList=this.value},computed:{posMoveImageLeft:function(){return this.moveLeft+"px"},posMoveImageTop:function(){return this.moveTop+"px"},isShowDel:function(){return!1!==this.enableDel},isShowAdd:function(){return!1!==this.enableAdd&&!(this.limit&&this.imageList.length>=this.limit)},isDragable:function(){return!1!==this.enableDrag}},methods:{selectImage:function(){a=this,a.imageList||(a.imageList=[]),t.chooseImage({count:a.limit?a.limit-a.imageList.length:999,success:function(e){var i=e.tempFilePaths;if(a.limit){var s=a.limit-a.imageList.length;if(s<i.length)return void t.showToast({title:"图片总数限制为"+a.limit+"张，当前还可以选"+s+"张",icon:"none",mask:!1,duration:2e3})}for(var o=0;o<i.length;o++)a.imageList.push(i[o]);if(a.serverUrl){for(var n=a.imageList.length-i.length,r=[],l=a.fileKeyName?a.fileKeyName:"upload-images",c=0,u=function(e){r.push(new Promise(function(s,o){var r=n+e;t.uploadFile({url:a.serverUrl,fileType:"image",formData:a.formData,filePath:i[e],name:l,success:function(e){200===e.statusCode?(a.imageList[r]=e.data,c++,a.showUploadProgress&&t.showToast({title:"上传进度："+c+"/"+i.length,icon:"none",mask:!1,duration:1e3}),console.log("success to upload image: "+e.data),s("success to upload image:"+r)):(console.log("fail to upload image:"+e.data),o("failt to upload image:"+r))},fail:function(t){console.log("fail to upload image:"+t),o("failt to upload image:"+r)}})}))},g=0;g<i.length;g++)u(g);Promise.all(r).then(function(t){a.$emit("add",{currentImages:i,allImages:a.imageList}),a.$emit("input",a.imageList)})}else a.$emit("add",{currentImages:i,allImages:a.imageList}),a.$emit("input",a.imageList)}})},deleteImage:function(e){var a=e.currentTarget.dataset.index,i=this.imageList[a];this.imageList.splice(a,1),this.serverUrlDeleteImage&&t.request({url:this.serverUrlDeleteImage,method:"GET",data:{imagePath:i},success:function(t){console.log(t.data)}}),this.$emit("delete",{currentImage:i,allImages:this.imageList}),this.$emit("input",this.imageList)},previewImage:function(e){var a=e.currentTarget.dataset.index;t.previewImage({current:this.imageList[a],indicator:"number",loop:"true",urls:this.imageList})},initImageBasePos:function(){var e=.024;a=this,t.getSystemInfo({success:function(t){var i=t.screenWidth,s=Math.ceil(e*i),o=Math.ceil((i-2*s)/4);a.imageBasePos.x0=s,a.imageBasePos.w=o,a.imageBasePos.h=o}})},findOverlapImage:function(t,e){var a=Math.floor((t-this.imageBasePos.x0)/this.imageBasePos.w),i=Math.floor((e-this.imageBasePos.y0)/this.imageBasePos.h),s=4*i+a;return s},isDragging:function(t){return this.dragIndex===t},start:function(t){if(console.log(this.isDragable),this.isDragable){if(this.dragIndex=t.currentTarget.dataset.index,this.moveImagePath=this.imageList[this.dragIndex],this.showMoveImage=!0,-1===this.imageBasePos.y0){this.initImageBasePos();var e=Math.floor(this.dragIndex/4)*this.imageBasePos.h,a=t.currentTarget.offsetTop;this.imageBasePos.y0=a-e}this.moveLeft=t.target.offsetLeft,this.moveTop=t.target.offsetTop}},move:function(t){if(this.isDragable){var e=t.touches[0];this.targetImageIndex=this.findOverlapImage(e.clientX,e.clientY),0===this.deltaLeft&&(this.deltaLeft=e.clientX-this.moveLeft,this.deltaTop=e.clientY-this.moveTop),this.moveLeft=e.clientX-this.deltaLeft,this.moveTop=e.clientY-this.deltaTop}},stop:function(t){this.isDragable&&(null!==this.dragIndex&&null!==this.targetImageIndex&&(this.targetImageIndex<0&&(this.targetImageIndex=0),this.targetImageIndex>=this.imageList.length&&(this.targetImageIndex=this.imageList.length-1),this.dragIndex!==this.targetImageIndex&&(this.imageList[this.dragIndex]=this.imageList[this.targetImageIndex],this.imageList[this.targetImageIndex]=this.moveImagePath)),this.dragIndex=null,this.targetImageIndex=null,this.deltaLeft=0,this.deltaTop=0,this.showMoveImage=!1,this.$emit("input",this.imageList))}}};e.default=i}).call(this,a("543d")["default"])},5896:function(t,e,a){},"5d4c":function(t,e,a){"use strict";a.r(e);var i=a("da41"),s=a("1dcf");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);a("ac8c");var n=a("2877"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"610b":function(t,e,a){"use strict";var i=a("5896"),s=a.n(i);s.a},8541:function(t,e,a){},ac8c:function(t,e,a){"use strict";var i=a("8541"),s=a.n(i);s.a},b062:function(t,e,a){"use strict";a.r(e);var i=a("bcb1"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},bcb1:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(a("23ec")),s=o(a("5d4c"));function o(t){return t&&t.__esModule?t:{default:t}}var n={components:{uniRate:i.default,robbyImageUpload:s.default},data:function(){return{val:2,bool:!1,goods:{},goodsList:[],current:5,num:"1",content:"",obj:{},comment:[],starList:[],star:{},say:{},order_no:"",imgData:[],imgUrl:{},tempFilePaths:[]}},methods:{bad:function(){this.val=2},good:function(){this.val=1},changeStar:function(t,e){this.num=t.value,this.star[e]=t.value},getcontent:function(t,e){this.say[e]=t.detail.value},save:function(){console.log(this.goodsList);this.goods.order_no;for(var e=0;e<this.goodsList.length;e++){var a={};for(var i in a.id=this.goodsList[e].id,this.star)i==e&&(a.comment_star=this.star[e]);for(var s in this.say)s==e&&(a.comment_content=this.say[e]);for(var s in this.imgUrl)s==e&&(a.comment_covers=this.imgUrl[e]);this.comment.push(a)}e>=this.goodsList.length&&(console.log(this.comment),this.request({url:this.config.url+"order/comment",method:"post",data:{order_no:this.order_no,good:this.val,comment:this.comment},success:function(e){1==e.data.code?(t.showToast({title:e.data.info}),setTimeout(function(){t.navigateTo({url:"/pages/user/keep/keep"})},1e3)):t.showToast({title:e.data.info})}}))},addPhoto:function(e){var a=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(i){var s=a.tempFilePaths;a.tempFilePaths=i.tempFilePaths.concat(s);t.uploadFile({url:a.config.url+"/Upload",filePath:a.tempFilePaths[0],name:"file",formData:{user:"test"},success:function(t){var i=JSON.parse(t.data),s=i.data.url,o=[];if(o.push(s),a.imgUrl[e]){s=a.imgUrl[e].concat(o);a.$set(a.imgUrl,e,s)}else a.$set(a.imgUrl,e,o)}})},error:function(t){console.log(t)}})}},onLoad:function(t){t.eval&&(this.goods=JSON.parse(t.eval),console.log(this.goods),this.goodsList=this.goods.order_list,this.order_no=this.goods.order_no,console.log(this.goodsList))}};e.default=n}).call(this,a("543d")["default"])},c58d:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"sayfeel"},[a("view",{staticClass:"send-msg"},[a("view",{staticClass:"send-top"},[a("view",{staticClass:"people-content"},[a("view",{staticClass:"img"},[a("image",{attrs:{src:t.goods.fromuser.headimg}})]),a("view",[a("text",[t._v(t._s(t.goods.fromuser.name))]),a("text",[t._v(t._s(t.goods.fromuser.phone))])])]),a("view",{staticClass:"right"},[t._v("评价快递员")])]),a("view",{staticClass:"send-bottom"},[a("radio-group",{staticClass:"send-bottom",attrs:{mpcomid:"f1013c54-0"}},[a("label",{staticClass:"radio"},[a("radio",{attrs:{value:"1",eventid:"f1013c54-0"},on:{click:function(e){t.bad(0)}}}),t._v("不满意")],1),a("label",{staticClass:"radio"},[a("radio",{attrs:{value:"2",checked:"true",eventid:"f1013c54-1"},on:{click:function(e){t.good(1)}}}),t._v("满意")],1)],1)],1)]),a("view",{staticClass:"product-msg"},t._l(t.goodsList,function(e,i){return a("view",{key:i,staticClass:"product-top"},[a("view",{staticClass:"list"},[a("image",{attrs:{src:e.goods_logo}}),a("view",{staticClass:"product-top-right"},[a("text",[t._v(t._s(e.goods_title))]),a("view",{staticClass:"price-num"},[a("view",{staticClass:"price"},[a("text",[t._v("￥")]),a("text",[t._v(t._s(e.price_selling))])]),a("view",{staticClass:"num"},[t._v("x"+t._s(e.number))])])])]),a("view",{staticClass:"product-bottom"},[a("view",{staticClass:"left"},[t._v("评分")]),a("view",{staticClass:"right"},[a("uni-rate",{attrs:{max:"5",value:t.num,eventid:"f1013c54-2-"+i,mpcomid:"f1013c54-1-"+i},on:{change:function(e){t.changeStar(e,i)}}})],1)]),a("view",{staticClass:"upload-photo"},[a("textarea",{attrs:{placeholder:"分享本次购物体验",eventid:"f1013c54-3-"+i},on:{blur:function(e){t.getcontent(e,i)}}}),a("view",{staticClass:"upload-imgs"},[t._l(t.imgUrl[i],function(t,e){return a("image",{key:e,staticClass:"uploadImg",attrs:{src:t}})}),a("view",{staticClass:"add-photo",attrs:{eventid:"f1013c54-4-"+i},on:{click:function(e){t.addPhoto(i)}}},[a("image",{attrs:{src:"../../../../static/img/sayfeel/photo.png"}}),a("text",[t._v("添加图片")])])],2)])])})),a("view",{staticClass:"submit",attrs:{eventid:"f1013c54-5"},on:{click:function(e){t.save()}}},[a("view",[t._v("提交")])])])},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},da41:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"imageUploadContainer"},[a("view",{staticClass:"imageUploadList"},[t._l(t.imageList,function(e,i){return a("view",{key:i,staticClass:"imageItem"},[a("image",{class:{dragging:t.isDragging(i)},attrs:{src:e,draggable:"true","data-index":i,eventid:"783ff93c-0-"+i},on:{tap:t.previewImage,touchstart:t.start,touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.move(e)},touchend:t.stop}}),t.isShowDel?a("view",{staticClass:"imageDel",attrs:{"data-index":i,eventid:"783ff93c-1-"+i},on:{tap:t.deleteImage}},[t._v("x")]):t._e()])}),t.isShowAdd?a("view",{staticClass:"imageUpload",attrs:{eventid:"783ff93c-2"},on:{tap:t.selectImage}},[t._v("+")]):t._e()],2),t.showMoveImage?a("image",{staticClass:"moveImage",style:{left:t.posMoveImageLeft,top:t.posMoveImageTop},attrs:{src:t.moveImagePath}}):t._e()])},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},feef:function(t,e,a){"use strict";a.r(e);var i=a("c58d"),s=a("b062");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);a("610b");var n=a("2877"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports}},[["03ea","common/runtime","common/vendor"]]]);